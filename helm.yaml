# This configuration file can be used to build and deploy the todo-backend
# quickstart on OpenShift with the Helm Chart for EAP.
build:
  uri: https://github.com/savitharaghunathan/kitchensink.git
  ref: galleon
  mode: s2i
  s2i:
    featurePacks:
      - org.jboss.eap:eap-datasources-galleon-pack:7.4.0.GA-redhat-00003
    galleonLayers: jaxrs-server,postgresql-driver
  env:
    - name: MAVEN_ARGS_APPEND
      value: '-Dcom.redhat.xpaas.repo.jbossorg'
    - name: GALLEON_PROVISION_FEATURE_PACKS 
      value: "org.jboss.eap:eap-datasources-galleon-pack:7.4.0.GA-redhat-00003"
    - name: GALLEON_PROVISION_LAYERS
      value: "cloud-server,postgresql-datasource,jsf,ejb"
    - name: POSTGRESQL_DRIVER_VERSION
      value: 42.2.19
deploy:
  replicas: 1
  env:
    # Env vars to connect to PostgreSQL DB
    - name: POSTGRESQL_DATABASE
      valueFrom:
        secretKeyRef:
          key: database-name
          name: kitchensink-db
    - name: POSTGRESQL_USER
      valueFrom:
        secretKeyRef:
          key: database-user
          name: kitchensink-db
    - name: POSTGRESQL_PASSWORD
      valueFrom:
        secretKeyRef:
          key: database-password
          name: kitchensink-db
    - name: POSTGRESQL_DATASOURCE
      value: Kitchensink
    - name: POSTGRESQL_SERVICE_HOST
      value: kitchensink-db
    - name: POSTGRESQL_SERVICE_PORT
      value: "5432"
